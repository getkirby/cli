#!/usr/bin/env php
<?php

$files = glob(getcwd().'/*/index.php', GLOB_BRACE);

$path = array_map(function ($file) {
	preg_match_all("#(/www/|/public/|/public_html/)#i", $file, $matches);

	if(!empty($matches))
	{
		return $matches;
	}
}, $files);

$path = $path[0][0][0] ?? '/';
$index = getcwd().($path ?? '/').'index.php';

// try to load Kirbyâ€™s index.php
if (file_exists($index) === true) {
	// switch off the renderer to
	// avoid any output in the CLI
	$_ENV['KIRBY_RENDER'] = false;

	ob_start();
	require $index;
	ob_end_clean();

	// rendering could be useful in commands
	// again. That's why we switch it back on
	$_ENV['KIRBY_RENDER'] = true;
}

require_once $_composer_autoload_path ?? __DIR__ . '/../vendor/autoload.php';

Kirby\CLI\CLI::command(...array_slice($argv, 1));
